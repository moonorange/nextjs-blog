"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}loadDateUtils=function(){function a(t){return void 0!==t&&(e=t),e}var r={},e=new Date;r.now=a,r.parseTime=function(t){var e,n,r=(t=String(t||"").toLowerCase().replace(/[Ａ-Ｚａ-ｚ０-９]/g,function(t){return String.fromCharCode(t.charCodeAt(0)-65248)})).match(/((\d{1,2})\s*[:時]{1}\s*(\d{1,2})\s*(pm|)|(am|pm|午前|午後)\s*(\d{1,2})(\s*[:時]\s*(\d{1,2})|)|(\d{1,2})(\s*[:時]{1}\s*(\d{1,2})|)(am|pm)|(\d{1,2})\s*時)/);return r?(null!=r[2]&&(e=parseInt(r[2],10),n=parseInt(r[3]?r[3]:"0",10),_.contains(["pm"],r[4])&&(e+=12)),null!=r[5]&&(e=parseInt(r[6],10),n=parseInt(r[8]?r[8]:"0",10),_.contains(["pm","午後"],r[5])&&(e+=12)),null!=r[9]&&(e=parseInt(r[9],10),n=parseInt(r[11]?r[11]:"0",10),_.contains(["pm"],r[12])&&(e+=12)),null!=r[13]&&(e=parseInt(r[13],10),n=0),[e,n]):null},r.parseDate=function(t){if((t=String(t||"").toLowerCase().replace(/[Ａ-Ｚａ-ｚ０-９]/g,function(t){return String.fromCharCode(t.charCodeAt(0)-65248)})).match(/(明日|tomorrow)/)){var e=new Date(a().getFullYear(),a().getMonth(),a().getDate()+1);return[e.getFullYear(),e.getMonth()+1,e.getDate()]}if(t.match(/(今日|today)/))return[a().getFullYear(),a().getMonth()+1,a().getDate()];if(t.match(/(昨日|yesterday)/)){var n=new Date(a().getFullYear(),a().getMonth(),a().getDate()-1);return[n.getFullYear(),n.getMonth()+1,n.getDate()]}var r=t.match(/((\d{4})[-\/年]{1}|)(\d{1,2})[-\/月]{1}(\d{1,2})/);if(r){var i=parseInt(r[2],10),s=parseInt(r[3],10),o=parseInt(r[4],10);return(_.isNaN(i)||i<1970)&&(i=11<=a().getMonth()+1&&s<=2?a().getFullYear()+1:a().getMonth()+1<=2&&11<=s?a().getFullYear()-1:a().getFullYear()),[i,s,o]}return null},r.normalizeDateTime=function(t,e){return t?e||(t=null):(t=[a().getFullYear(),a().getMonth()+1,a().getDate()],e=e||[a().getHours(),a().getMinutes()]),t&&e?new Date(t[0],t[1]-1,t[2],e[0],e[1],0):null},r.parseDateTime=function(t){var e=r.parseDate(t),n=r.parseTime(t);return e?n?new Date(e[0],e[1]-1,e[2],n[0],n[1],0):new Date(e[0],e[1]-1,e[2],0,0,0):null},r.toDate=function(t){return new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0)},r.parseWday=function(t){t=String(t).replace(/曜日/g,"");for(var e=[],n=[/(sun|日)/i,/(mon|月)/i,/(tue|火)/i,/(wed|水)/i,/(thu|木)/i,/(fri|金)/i,/(sat|土)/i],r=0;r<n.length;++r)t.match(n[r])&&e.push(r);return e};var s={Y:function(){return this.getFullYear()},y:function(){return String(this.getFullYear()).substr(-2,2)},m:function(){return("0"+(this.getMonth()+1)).substr(-2,2)},d:function(){return("0"+this.getDate()).substr(-2,2)},H:function(){return("0"+this.getHours()).substr(-2,2)},M:function(){return("0"+this.getMinutes()).substr(-2,2)},s:function(){return("0"+this.getSeconds()).substr(-2,2)}};return r.format=function(t,e){for(var n="",r=0;r<t.length;r++){var i=t.charAt(r);s[i]?n+=s[i].call(e):n+=i}return n},r},"undefined"!=typeof exports&&(exports.DateUtils=loadDateUtils()),loadEventListener=function(){function t(){this._events={}}return t.prototype.on=function(t,e){this._events[t]?this._events[t].push(e):this._events[t]=[e]},t.prototype.fireEvent=function(t){var e=this._events[t];if(e)for(var n=0;n<e.length;++n)e[n].apply(this,Array.prototype.slice.call(arguments,1))},t},"undefined"!=typeof exports&&(exports.EventListener=loadEventListener()),loadGASProperties=function(){function t(){this.properties=PropertiesService.getScriptProperties()}return t.prototype.get=function(t){return this.properties.getProperty(t)},t.prototype.set=function(t,e){return this.properties.setProperty(t,e),e},t},"undefined"!=typeof exports&&(exports.GASProperties=loadGASProperties()),"undefined"==typeof console&&"undefined"!=typeof Logger&&(console={log:function(){Logger.log(Array.prototype.slice.call(arguments).join(", "))}}),loadGSProperties=function(){function t(t){this.sheet=t.getSheetByName("_設定"),this.sheet||(this.sheet=t.insertSheet("_設定"))}return t.prototype.get=function(e){if(this.sheet.getLastRow()<1)return defaultValue;var t=_.find(this.sheet.getRange("A1:B"+this.sheet.getLastRow()).getValues(),function(t){return t[0]==e});return t?_.isDate(t[1])?DateUtils.format("Y-m-d H:M:s",t[1]):String(t[1]):null},t.prototype.set=function(t,e){if(0<this.sheet.getLastRow())for(var n=this.sheet.getRange("A1:A"+this.sheet.getLastRow()).getValues(),r=0;r<this.sheet.getLastRow();++r)if(n[r][0]==t)return this.sheet.getRange("B"+(r+1)).setValue(String(e)),e;return this.sheet.getRange("A"+(this.sheet.getLastRow()+1)+":B"+(this.sheet.getLastRow()+1)).setValues([[t,e]]),e},t.prototype.setNote=function(t,e){if(0<this.sheet.getLastRow())for(var n=this.sheet.getRange("A1:A"+this.sheet.getLastRow()).getValues(),r=0;r<this.sheet.getLastRow();++r)if(n[r][0]==t)return void this.sheet.getRange("C"+(r+1)).setValue(e);this.sheet.getRange("A"+(this.sheet.getLastRow()+1)+":C"+(this.sheet.getLastRow()+1)).setValues([[t,"",e]])},t},"undefined"!=typeof exports&&(exports.GSProperties=loadGSProperties()),loadGSTemplate=function(){function t(t){if(this.spreadsheet=t,this.sheet=this.spreadsheet.getSheetByName("_メッセージ"),!this.sheet){if(this.sheet=this.spreadsheet.insertSheet("_メッセージ"),!this.sheet)throw"エラー: メッセージシートを作れませんでした";DateUtils.now();this.sheet.getRange("A1:L2").setValues([["出勤","出勤更新","退勤","退勤更新","休暇","休暇更新","休暇おわり","休暇おわり更新","出勤中","出勤なし","休暇中","休暇なし","出勤確認","退勤確認"],["<@#1> おはようございます (#2)","<@#1> 出勤時間を#2へ変更しました","<@#1> お疲れ様でした (#2)","<@#1> 退勤時間を#2へ変更しました","<@#1> #2を休暇として登録しました","<@#1> #2の休暇を取り消しました","#1が出勤しています","全員退勤しています","#1は#2が休暇です","#1に休暇の人はいません","今日は休暇ですか？ #1","退勤しましたか？ #1"]])}}return t.prototype.template=function(t){for(var e=this.sheet.getRange("A1:Z1").getValues()[0],n=0;n<e.length;++n)if(e[n]==t){for(var r=_.sample(_.filter(_.map(this.sheet.getRange(String.fromCharCode(n+65)+"2:"+String.fromCharCode(n+65)).getValues(),function(t){return t[0]}),function(t){return!!t})),n=1;n<arguments.length;n++){var i=arguments[n];_.isArray(i)&&(i=_.map(i,function(t){return"<@"+t+">"}).join(", ")),r=r.replace("#"+n,i)}return r}return arguments.join(", ")},t},"undefined"!=typeof exports&&(exports.GSTemplate=loadGSTemplate()),loadGSTimesheets=function(){function t(t,e){this.spreadsheet=t,this.settings=e,this._sheets={},this.scheme={columns:[{name:"日付"},{name:"出勤"},{name:"退勤"},{name:"休憩"},{name:"休憩おわり"},{name:"休憩2"},{name:"休憩2おわり"}],properties:[{name:"DayOff",value:"土,日",comment:"← 月,火,水みたいに入力してください。アカウント停止のためには「全部」と入れてください。"}]}}return t.prototype._getSheet=function(t){if(this._sheets[t])return this._sheets[t];var e,n,r,i=this.spreadsheet.getSheetByName(t);if(!i){if(!(i=this.spreadsheet.insertSheet(t)))throw"エラー: "+sheetName+"のシートが作れませんでした";0==i.getLastRow()&&(e=[["Properties count",this.scheme.properties.length,null]],this.scheme.properties.forEach(function(t){e.push([t.name,t.value,t.comment])}),i.getRange("A1:C"+e.length).setValues(e),n=e.length+2,r=this.scheme.columns.map(function(t){return t.name}),i.getRange("A"+n+":"+String.fromCharCode(65+r.length-1)+n).setValues([r]))}return this._sheets[t]=i},t.prototype._getRowNo=function(t,e){e=e||DateUtils.now();var n=this.scheme.properties.length+4,r=DateUtils.parseDate(this.settings.get("開始日")),i=new Date(r[0],r[1]-1,r[2],0,0,0);return n+=parseInt((e.getTime()-60*e.getTimezoneOffset()*1e3)/864e5,10)-parseInt((i.getTime()-60*i.getTimezoneOffset()*1e3)/864e5,10)},t.prototype.get=function(t,e){var n=this._getSheet(t),r=this._getRowNo(t,e),i=n.getRange("A"+r+":"+String.fromCharCode(65+this.scheme.columns.length-1)+r).getValues()[0].map(function(t){return""===t?void 0:t});return{user:t,date:i[0],signIn:i[1],signOut:i[2],rest:i[3],restOff:i[4],takeBreak:i[5],restart:i[6]}},t.prototype.set=function(t,e,n){var r=this.get(t,e);_.extend(r,_.pick(n,"signIn","signOut","rest","restOff","takeBreak","restart"));var i=this._getSheet(t),s=this._getRowNo(t,e),o=[DateUtils.toDate(e),r.signIn,r.signOut,r.rest,r.restOff,r.takeBreak,r.restart].map(function(t){return null==t?"":t});return i.getRange("A"+s+":"+String.fromCharCode(65+this.scheme.columns.length-1)+s).setValues([o]),r},t.prototype.getUsers=function(){return _.compact(_.map(this.spreadsheet.getSheets(),function(t){var e=t.getName();return"_"==String(e).substr(0,1)?void 0:e}))},t.prototype.getByDate=function(e){var n=this;return _.map(this.getUsers(),function(t){return n.get(t,e)})},t.prototype.getDayOff=function(t){var e=this._getSheet(t);return DateUtils.parseWday(e.getRange("B2").getValue())},t},"undefined"!=typeof exports&&(exports.GSTimesheets=loadGSTimesheets());var initLibraries=function(){"undefined"==typeof EventListener&&(EventListener=loadEventListener()),"undefined"==typeof DateUtils&&(DateUtils=loadDateUtils()),"undefined"==typeof GASProperties&&(GASProperties=loadGASProperties()),"undefined"==typeof GSProperties&&(GSProperties=loadGSProperties()),"undefined"==typeof GSTemplate&&(GSTemplate=loadGSTemplate()),"undefined"==typeof GSTimesheets&&(GSTimesheets=loadGSTimesheets()),"undefined"==typeof Timesheets&&(Timesheets=loadTimesheets()),"undefined"==typeof Slack&&(Slack=loadSlack())},init=function(){initLibraries();var t=(new GASProperties).get("spreadsheet");if(t){var e=SpreadsheetApp.openById(t),n=new GSProperties(e),r=new GSTemplate(e),i=new Slack(n.get("Slack Incoming URL"),r,n),s=new GSTimesheets(e,n);return{receiver:i,timesheets:new Timesheets(s,n,i),storage:s}}return null};function doPost(t){init().receiver.receiveMessage(t.parameters)}function confirmSignIn(){init().timesheets.confirmSignIn()}function confirmSignOut(){init().timesheets.confirmSignOut()}function setUp(){initLibraries();var t,e,n,r,i,s,o=new GASProperties;o.get("spreadsheet")||(1==(e=(t=SpreadsheetApp.create("Slack Timesheets")).getSheets()).length&&0==e[0].getLastRow()&&e[0].setName("_設定"),o.set("spreadsheet",t.getId()),(n=new GSProperties(t)).set("Slack Incoming URL",""),n.setNote("Slack Incoming URL","Slackのincoming URLを入力してください"),n.set("開始日",DateUtils.format("Y-m-d",DateUtils.now())),n.setNote("開始日","変更はしないでください"),n.set("無視するユーザ","miyamoto,hubot,slackbot,incoming-webhook"),n.setNote("無視するユーザ","反応をしないユーザを,区切りで設定する。botは必ず指定してください。"),s=[],o.get("apiKey")&&(r="https://www.googleapis.com/calendar/v3/calendars/japanese@holiday.calendar.google.com/events?maxResults=1000&orderBy=startTime&singleEvents=true&timeMin="+DateUtils.format("Y-m-dT00:00:00Z",DateUtils.now())+"&key="+o.get("apiKey"),i=JSON.parse(UrlFetchApp.fetch(r).getContentText()),s=_.map(i.items,function(t){return t.start.date})),n.set("休日",s.join(", ")),n.setNote("休日","日付を,区切りで。来年までは自動設定されているので、以後は適当に更新してください"),new GSTemplate(t),ScriptApp.newTrigger("confirmSignIn").timeBased().everyDays(1).atHour(11).create(),ScriptApp.newTrigger("confirmSignOut").timeBased().everyDays(1).atHour(22).create())}function migrate(){"undefined"==typeof GASProperties&&(GASProperties=loadGASProperties()),(new GASProperties).set("version","20141027.0"),console.log("バージョンアップが完了しました。")}loadSlack=function(){function t(t,e,n){EventListener.apply(this),this.incomingURL=t,this._template=e,this.settings=n}return"undefined"==typeof EventListener&&(EventListener=loadEventListener()),_.extend(t.prototype,EventListener.prototype),t.prototype.receiveMessage=function(t){var e=String(t.user_name),n=String(t.text),r=(this.settings.get("無視するユーザ")||"").toLowerCase().replace(/^\s*(.*?)\s*$/,"$1").split(/\s*,\s*/);_.contains(r,e.toLowerCase())||n.match(/^-/)||this.fireEvent("receiveMessage",e,n)},t.prototype.send=function(t,e){(e=_.clone(e||{})).text=t;var n={method:"post",payload:{payload:JSON.stringify(e)}};return this.incomingURL&&UrlFetchApp.fetch(this.incomingURL,n),t},t.prototype.template=function(){this.send(this._template.template.apply(this._template,arguments))},t},"undefined"!=typeof exports&&(exports.Slack=loadSlack()),loadTimesheets=function(){function t(t,e,n){this.storage=t,this.responder=n,this.settings=e;var r=this;this.responder.on("receiveMessage",function(t,e){r.receiveMessage(t,e)})}return t.prototype.receiveMessage=function(t,e){this.date=DateUtils.parseDate(e),this.time=DateUtils.parseTime(e),this.datetime=DateUtils.normalizeDateTime(this.date,this.time),null!==this.datetime&&(this.dateStr=DateUtils.format("Y/m/d",this.datetime),this.datetimeStr=DateUtils.format("Y/m/d H:M",this.datetime));var n=_.find([["actionSignOut",/(bye)/],["actionWhoIsOff",/(だれ|誰|who\s*is).*(やす(ま|み|む))/],["actionWhoIsIn",/(だれ|誰|who\s*is)/],["actionRest",/(break)/],["actionRestOff",/(restart)/],["actionTakeBreak",/(休憩|休)/],["actionRestart",/(再開)/],["actionSignIn",/(hi)/],["confirmSignIn",/__confirmSignIn__/],["confirmSignOut",/__confirmSignOut__/]],function(t){return t&&e.match(t[1])});if(n&&this[n[0]])return this[n[0]](t,e)},t.prototype.actionSignIn=function(t,e){var n;this.datetime&&((n=this.storage.get(t,this.datetime)).signIn&&"-"!==n.signIn?this.time&&(this.storage.set(t,this.datetime,{signIn:this.datetime}),this.responder.template("出勤更新",t,this.datetimeStr)):(this.storage.set(t,this.datetime,{signIn:this.datetime}),this.responder.template("出勤",t,this.datetimeStr)))},t.prototype.actionSignOut=function(t,e){var n;this.datetime&&((n=this.storage.get(t,this.datetime)).signOut&&"-"!==n.signOut?this.time&&(this.storage.set(t,this.datetime,{signOut:this.datetime}),this.responder.template("退勤更新",t,this.datetimeStr)):(this.storage.set(t,this.datetime,{signOut:this.datetime}),this.responder.template("退勤",t,this.datetimeStr)))},t.prototype.actionRest=function(t,e){var n;this.datetime&&((n=this.storage.get(t,this.datetime)).rest&&"-"!==n.rest?this.time&&(this.storage.set(t,this.datetime,{rest:this.datetime}),this.responder.template("休憩更新",t,this.datetimeStr)):(this.storage.set(t,this.datetime,{rest:this.datetime}),this.responder.template("休憩",t,this.datetimeStr)))},t.prototype.actionRestOff=function(t,e){var n;this.datetime&&((n=this.storage.get(t,this.datetime)).restOff&&"-"!==n.restOff?this.time&&(this.storage.set(t,this.datetime,{restOff:this.datetime}),this.responder.template("休憩おわり更新",t,this.datetimeStr)):(this.storage.set(t,this.datetime,{restOff:this.datetime}),this.responder.template("休憩おわり",t,this.datetimeStr)))},t.prototype.actionTakeBreak=function(t,e){var n;this.datetime&&((n=this.storage.get(t,this.datetime)).takeBreak&&"-"!==n.takeBreak?this.time&&(this.storage.set(t,this.datetime,{takeBreak:this.datetime}),this.responder.template("休憩2更新",t,this.datetimeStr)):(this.storage.set(t,this.datetime,{takeBreak:this.datetime}),this.responder.template("休憩2",t,this.datetimeStr)))},t.prototype.actionRestart=function(t,e){var n;this.datetime&&((n=this.storage.get(t,this.datetime)).restart&&"-"!==n.restart?this.time&&(this.storage.set(t,this.datetime,{restart:this.datetime}),this.responder.template("休憩2おわり更新",t,this.datetimeStr)):(this.storage.set(t,this.datetime,{restart:this.datetime}),this.responder.template("休憩2おわり",t,this.datetimeStr)))},t.prototype.actionWhoIsIn=function(t,e){var n=DateUtils.toDate(DateUtils.now()),r=_.compact(_.map(this.storage.getByDate(n),function(t){return _.isDate(t.signIn)&&!_.isDate(t.signOut)?t.user:void 0}));_.isEmpty(r)?this.responder.template("出勤なし"):this.responder.template("出勤中",r.sort().join(", "))},t.prototype.actionWhoIsOff=function(t,e){var n=DateUtils.toDate(DateUtils.now()),r=DateUtils.format("Y/m/d",n),i=_.compact(_.map(this.storage.getByDate(n),function(t){return"-"===t.signIn?t.user:void 0})),s=n.getDay(),o=this;_.each(this.storage.getUsers(),function(t){_.contains(o.storage.getDayOff(t),s)&&i.push(t)}),i=_.uniq(i),_.isEmpty(i)?this.responder.template("休暇なし",r):this.responder.template("休暇中",r,i.sort().join(", "))},t.prototype.confirmSignOut=function(t,e){var n=DateUtils.toDate(DateUtils.now()),r=_.compact(_.map(this.storage.getByDate(n),function(t){return _.isDate(t.signIn)&&!_.isDate(t.signOut)?t.user:void 0}));_.isEmpty(r)||this.responder.template("退勤確認",r.sort())},t},"undefined"!=typeof exports&&(exports.Timesheets=loadTimesheets()),function(){function p(t){return t instanceof p?t:this instanceof p?void(this._wrapped=t):new p(t)}var t=this,e=t._,r=Array.prototype,n=Object.prototype,i=Function.prototype,a=r.push,l=r.slice,c=r.concat,g=n.toString,s=n.hasOwnProperty,o=Array.isArray,u=Object.keys,f=i.bind;"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=p),exports._=p):t._=p,p.VERSION="1.7.0";function h(i,s,t){if(void 0===s)return i;switch(null==t?3:t){case 1:return function(t){return i.call(s,t)};case 2:return function(t,e){return i.call(s,t,e)};case 3:return function(t,e,n){return i.call(s,t,e,n)};case 4:return function(t,e,n,r){return i.call(s,t,e,n,r)}}return function(){return i.apply(s,arguments)}}p.iteratee=function(t,e,n){return null==t?p.identity:p.isFunction(t)?h(t,e,n):p.isObject(t)?p.matches(t):p.property(t)},p.each=p.forEach=function(t,e,n){if(null==t)return t;if(e=h(e,n),(s=t.length)===+s)for(i=0;i<s;i++)e(t[i],i,t);else for(var r=p.keys(t),i=0,s=r.length;i<s;i++)e(t[r[i]],r[i],t);return t},p.map=p.collect=function(t,e,n){if(null==t)return[];e=p.iteratee(e,n);for(var r,i=t.length!==+t.length&&p.keys(t),s=(i||t).length,o=Array(s),a=0;a<s;a++)r=i?i[a]:a,o[a]=e(t[r],r,t);return o};var m="Reduce of empty array with no initial value";p.reduce=p.foldl=p.inject=function(t,e,n,r){null==t&&(t=[]),e=h(e,r,4);var i,s=t.length!==+t.length&&p.keys(t),o=(s||t).length,a=0;if(arguments.length<3){if(!o)throw new TypeError(m);n=t[s?s[a++]:a++]}for(;a<o;a++)n=e(n,t[i=s?s[a]:a],i,t);return n},p.reduceRight=p.foldr=function(t,e,n,r){null==t&&(t=[]),e=h(e,r,4);var i,s=t.length!==+t.length&&p.keys(t),o=(s||t).length;if(arguments.length<3){if(!o)throw new TypeError(m);n=t[s?s[--o]:--o]}for(;o--;)n=e(n,t[i=s?s[o]:o],i,t);return n},p.find=p.detect=function(t,r,e){var i;return r=p.iteratee(r,e),p.some(t,function(t,e,n){return r(t,e,n)?(i=t,!0):void 0}),i},p.filter=p.select=function(t,r,e){var i=[];return null==t||(r=p.iteratee(r,e),p.each(t,function(t,e,n){r(t,e,n)&&i.push(t)})),i},p.reject=function(t,e,n){return p.filter(t,p.negate(p.iteratee(e)),n)},p.every=p.all=function(t,e,n){if(null==t)return!0;e=p.iteratee(e,n);for(var r,i=t.length!==+t.length&&p.keys(t),s=(i||t).length,o=0;o<s;o++)if(!e(t[r=i?i[o]:o],r,t))return!1;return!0},p.some=p.any=function(t,e,n){if(null==t)return!1;e=p.iteratee(e,n);for(var r,i=t.length!==+t.length&&p.keys(t),s=(i||t).length,o=0;o<s;o++)if(e(t[r=i?i[o]:o],r,t))return!0;return!1},p.contains=p.include=function(t,e){return null!=t&&(t.length!==+t.length&&(t=p.values(t)),0<=p.indexOf(t,e))},p.invoke=function(t,e){var n=l.call(arguments,2),r=p.isFunction(e);return p.map(t,function(t){return(r?e:t[e]).apply(t,n)})},p.pluck=function(t,e){return p.map(t,p.property(e))},p.where=function(t,e){return p.filter(t,p.matches(e))},p.findWhere=function(t,e){return p.find(t,p.matches(e))},p.max=function(t,r,e){var n,i,s=-1/0,o=-1/0;if(null==r&&null!=t)for(var a=0,u=(t=t.length===+t.length?t:p.values(t)).length;a<u;a++)n=t[a],s<n&&(s=n);else r=p.iteratee(r,e),p.each(t,function(t,e,n){i=r(t,e,n),(o<i||i===-1/0&&s===-1/0)&&(s=t,o=i)});return s},p.min=function(t,r,e){var n,i,s=1/0,o=1/0;if(null==r&&null!=t)for(var a=0,u=(t=t.length===+t.length?t:p.values(t)).length;a<u;a++)(n=t[a])<s&&(s=n);else r=p.iteratee(r,e),p.each(t,function(t,e,n){((i=r(t,e,n))<o||1/0===i&&1/0===s)&&(s=t,o=i)});return s},p.shuffle=function(t){for(var e,n=t&&t.length===+t.length?t:p.values(t),r=n.length,i=Array(r),s=0;s<r;s++)(e=p.random(0,s))!==s&&(i[s]=i[e]),i[e]=n[s];return i},p.sample=function(t,e,n){return null==e||n?(t.length!==+t.length&&(t=p.values(t)),t[p.random(t.length-1)]):p.shuffle(t).slice(0,Math.max(0,e))},p.sortBy=function(t,r,e){return r=p.iteratee(r,e),p.pluck(p.map(t,function(t,e,n){return{value:t,index:e,criteria:r(t,e,n)}}).sort(function(t,e){var n=t.criteria,r=e.criteria;if(n!==r){if(r<n||void 0===n)return 1;if(n<r||void 0===r)return-1}return t.index-e.index}),"value")};function d(o){return function(r,i,t){var s={};return i=p.iteratee(i,t),p.each(r,function(t,e){var n=i(t,e,r);o(s,t,n)}),s}}p.groupBy=d(function(t,e,n){p.has(t,n)?t[n].push(e):t[n]=[e]}),p.indexBy=d(function(t,e,n){t[n]=e}),p.countBy=d(function(t,e,n){p.has(t,n)?t[n]++:t[n]=1}),p.sortedIndex=function(t,e,n,r){for(var i=(n=p.iteratee(n,r,1))(e),s=0,o=t.length;s<o;){var a=s+o>>>1;n(t[a])<i?s=1+a:o=a}return s},p.toArray=function(t){return t?p.isArray(t)?l.call(t):t.length===+t.length?p.map(t,p.identity):p.values(t):[]},p.size=function(t){return null==t?0:t.length===+t.length?t.length:p.keys(t).length},p.partition=function(t,r,e){r=p.iteratee(r,e);var i=[],s=[];return p.each(t,function(t,e,n){(r(t,e,n)?i:s).push(t)}),[i,s]},p.first=p.head=p.take=function(t,e,n){return null==t?void 0:null==e||n?t[0]:e<0?[]:l.call(t,0,e)},p.initial=function(t,e,n){return l.call(t,0,Math.max(0,t.length-(null==e||n?1:e)))},p.last=function(t,e,n){return null==t?void 0:null==e||n?t[t.length-1]:l.call(t,Math.max(t.length-e,0))},p.rest=p.tail=p.drop=function(t,e,n){return l.call(t,null==e||n?1:e)},p.compact=function(t){return p.filter(t,p.identity)};function y(t,e,n,r){if(e&&p.every(t,p.isArray))return c.apply(r,t);for(var i=0,s=t.length;i<s;i++){var o=t[i];p.isArray(o)||p.isArguments(o)?e?a.apply(r,o):y(o,e,n,r):n||r.push(o)}return r}p.flatten=function(t,e){return y(t,e,!1,[])},p.without=function(t){return p.difference(t,l.call(arguments,1))},p.uniq=p.unique=function(t,e,n,r){if(null==t)return[];p.isBoolean(e)||(r=n,n=e,e=!1),null!=n&&(n=p.iteratee(n,r));for(var i=[],s=[],o=0,a=t.length;o<a;o++){var u,l=t[o];e?(o&&s===l||i.push(l),s=l):n?(u=n(l,o,t),p.indexOf(s,u)<0&&(s.push(u),i.push(l))):p.indexOf(i,l)<0&&i.push(l)}return i},p.union=function(){return p.uniq(y(arguments,!0,!0,[]))},p.intersection=function(t){if(null==t)return[];for(var e=[],n=arguments.length,r=0,i=t.length;r<i;r++){var s=t[r];if(!p.contains(e,s)){for(var o=1;o<n&&p.contains(arguments[o],s);o++);o===n&&e.push(s)}}return e},p.difference=function(t){var e=y(l.call(arguments,1),!0,!0,[]);return p.filter(t,function(t){return!p.contains(e,t)})},p.zip=function(t){if(null==t)return[];for(var e=p.max(arguments,"length").length,n=Array(e),r=0;r<e;r++)n[r]=p.pluck(arguments,r);return n},p.object=function(t,e){if(null==t)return{};for(var n={},r=0,i=t.length;r<i;r++)e?n[t[r]]=e[r]:n[t[r][0]]=t[r][1];return n},p.indexOf=function(t,e,n){if(null==t)return-1;var r=0,i=t.length;if(n){if("number"!=typeof n)return t[r=p.sortedIndex(t,e)]===e?r:-1;r=n<0?Math.max(0,i+n):n}for(;r<i;r++)if(t[r]===e)return r;return-1},p.lastIndexOf=function(t,e,n){if(null==t)return-1;var r=t.length;for("number"==typeof n&&(r=n<0?r+n+1:Math.min(r,n+1));0<=--r;)if(t[r]===e)return r;return-1},p.range=function(t,e,n){arguments.length<=1&&(e=t||0,t=0),n=n||1;for(var r=Math.max(Math.ceil((e-t)/n),0),i=Array(r),s=0;s<r;s++,t+=n)i[s]=t;return i};function v(){}p.bind=function(n,r){var i,s;if(f&&n.bind===f)return f.apply(n,l.call(arguments,1));if(!p.isFunction(n))throw new TypeError("Bind must be called on a function");return i=l.call(arguments,2),s=function(){if(!(this instanceof s))return n.apply(r,i.concat(l.call(arguments)));v.prototype=n.prototype;var t=new v;v.prototype=null;var e=n.apply(t,i.concat(l.call(arguments)));return p.isObject(e)?e:t}},p.partial=function(i){var s=l.call(arguments,1);return function(){for(var t=0,e=s.slice(),n=0,r=e.length;n<r;n++)e[n]===p&&(e[n]=arguments[t++]);for(;t<arguments.length;)e.push(arguments[t++]);return i.apply(this,e)}},p.bindAll=function(t){var e,n,r=arguments.length;if(r<=1)throw new Error("bindAll must be passed function names");for(e=1;e<r;e++)t[n=arguments[e]]=p.bind(t[n],t);return t},p.memoize=function(r,i){function s(t){var e=s.cache,n=i?i.apply(this,arguments):t;return p.has(e,n)||(e[n]=r.apply(this,arguments)),e[n]}return s.cache={},s},p.delay=function(t,e){var n=l.call(arguments,2);return setTimeout(function(){return t.apply(null,n)},e)},p.defer=function(t){return p.delay.apply(p,[t,1].concat(l.call(arguments,1)))},p.throttle=function(n,r,i){var s,o,a,u=null,l=0;i=i||{};function c(){l=!1===i.leading?0:p.now(),u=null,a=n.apply(s,o),u||(s=o=null)}return function(){var t=p.now();l||!1!==i.leading||(l=t);var e=r-(t-l);return s=this,o=arguments,e<=0||r<e?(clearTimeout(u),u=null,l=t,a=n.apply(s,o),u||(s=o=null)):u||!1===i.trailing||(u=setTimeout(c,e)),a}},p.debounce=function(e,n,r){function i(){var t=p.now()-u;t<n&&0<t?s=setTimeout(i,n-t):(s=null,r||(l=e.apply(a,o),s||(a=o=null)))}var s,o,a,u,l;return function(){a=this,o=arguments,u=p.now();var t=r&&!s;return s=s||setTimeout(i,n),t&&(l=e.apply(a,o),a=o=null),l}},p.wrap=function(t,e){return p.partial(e,t)},p.negate=function(t){return function(){return!t.apply(this,arguments)}},p.compose=function(){var n=arguments,r=n.length-1;return function(){for(var t=r,e=n[r].apply(this,arguments);t--;)e=n[t].call(this,e);return e}},p.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},p.once=p.partial(p.before=function(t,e){var n;return function(){return 0<--t?n=e.apply(this,arguments):e=null,n}},2),p.keys=function(t){if(!p.isObject(t))return[];if(u)return u(t);var e=[];for(var n in t)p.has(t,n)&&e.push(n);return e},p.values=function(t){for(var e=p.keys(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=t[e[i]];return r},p.pairs=function(t){for(var e=p.keys(t),n=e.length,r=Array(n),i=0;i<n;i++)r[i]=[e[i],t[e[i]]];return r},p.invert=function(t){for(var e={},n=p.keys(t),r=0,i=n.length;r<i;r++)e[t[n[r]]]=n[r];return e},p.functions=p.methods=function(t){var e=[];for(var n in t)p.isFunction(t[n])&&e.push(n);return e.sort()},p.extend=function(t){if(!p.isObject(t))return t;for(var e,n,r=1,i=arguments.length;r<i;r++)for(n in e=arguments[r])s.call(e,n)&&(t[n]=e[n]);return t},p.pick=function(t,e,n){var r,i={};if(null==t)return i;if(p.isFunction(e))for(r in e=h(e,n),t){var s=t[r];e(s,r,t)&&(i[r]=s)}else{var o=c.apply([],l.call(arguments,1));t=new Object(t);for(var a=0,u=o.length;a<u;a++)(r=o[a])in t&&(i[r]=t[r])}return i},p.omit=function(t,e,n){var r;return e=p.isFunction(e)?p.negate(e):(r=p.map(c.apply([],l.call(arguments,1)),String),function(t,e){return!p.contains(r,e)}),p.pick(t,e,n)},p.defaults=function(t){if(!p.isObject(t))return t;for(var e=1,n=arguments.length;e<n;e++){var r=arguments[e];for(var i in r)void 0===t[i]&&(t[i]=r[i])}return t},p.clone=function(t){return p.isObject(t)?p.isArray(t)?t.slice():p.extend({},t):t},p.tap=function(t,e){return e(t),t};p.isEqual=function(t,e){return function t(e,n,r,i){if(e===n)return 0!==e||1/e==1/n;if(null==e||null==n)return e===n;e instanceof p&&(e=e._wrapped),n instanceof p&&(n=n._wrapped);var s=g.call(e);if(s!==g.call(n))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+e==""+n;case"[object Number]":return+e!=+e?+n!=+n:0==+e?1/e==1/n:+e==+n;case"[object Date]":case"[object Boolean]":return+e==+n}if("object"!=_typeof(e)||"object"!=_typeof(n))return!1;for(var o=r.length;o--;)if(r[o]===e)return i[o]===n;var a,u=e.constructor,l=n.constructor;if(u!==l&&"constructor"in e&&"constructor"in n&&!(p.isFunction(u)&&u instanceof u&&p.isFunction(l)&&l instanceof l))return!1;if(r.push(e),i.push(n),"[object Array]"===s){if(a=(h=e.length)===n.length)for(;h--&&(a=t(e[h],n[h],r,i)););}else{var c,f=p.keys(e),h=f.length;if(a=p.keys(n).length===h)for(;h--&&(c=f[h],a=p.has(n,c)&&t(e[c],n[c],r,i)););}return r.pop(),i.pop(),a}(t,e,[],[])},p.isEmpty=function(t){if(null==t)return!0;if(p.isArray(t)||p.isString(t)||p.isArguments(t))return 0===t.length;for(var e in t)if(p.has(t,e))return!1;return!0},p.isElement=function(t){return!(!t||1!==t.nodeType)},p.isArray=o||function(t){return"[object Array]"===g.call(t)},p.isObject=function(t){var e=_typeof(t);return"function"===e||"object"===e&&!!t},p.each(["Arguments","Function","String","Number","Date","RegExp"],function(e){p["is"+e]=function(t){return g.call(t)==="[object "+e+"]"}}),p.isArguments(arguments)||(p.isArguments=function(t){return p.has(t,"callee")}),"function"!=typeof/./&&(p.isFunction=function(t){return"function"==typeof t||!1}),p.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},p.isNaN=function(t){return p.isNumber(t)&&t!==+t},p.isBoolean=function(t){return!0===t||!1===t||"[object Boolean]"===g.call(t)},p.isNull=function(t){return null===t},p.isUndefined=function(t){return void 0===t},p.has=function(t,e){return null!=t&&s.call(t,e)},p.noConflict=function(){return t._=e,this},p.identity=function(t){return t},p.constant=function(t){return function(){return t}},p.noop=function(){},p.property=function(e){return function(t){return t[e]}},p.matches=function(t){var i=p.pairs(t),s=i.length;return function(t){if(null==t)return!s;t=new Object(t);for(var e=0;e<s;e++){var n=i[e],r=n[0];if(n[1]!==t[r]||!(r in t))return!1}return!0}},p.times=function(t,e,n){var r=Array(Math.max(0,t));e=h(e,n,1);for(var i=0;i<t;i++)r[i]=e(i);return r},p.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},p.now=Date.now||function(){return(new Date).getTime()};function S(e){function n(t){return e[t]}var t="(?:"+p.keys(e).join("|")+")",r=RegExp(t),i=RegExp(t,"g");return function(t){return t=null==t?"":""+t,r.test(t)?t.replace(i,n):t}}var _={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},w=p.invert(_);p.escape=S(_),p.unescape=S(w),p.result=function(t,e){if(null!=t){var n=t[e];return p.isFunction(n)?t[e]():n}};var D=0;p.uniqueId=function(t){var e=++D+"";return t?t+e:e},p.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};function b(t){return"\\"+k[t]}var A=/(.)^/,k={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},x=/\\|'|\r|\n|\u2028|\u2029/g;p.template=function(s,t,e){!t&&e&&(t=e),t=p.defaults({},t,p.templateSettings);var n=RegExp([(t.escape||A).source,(t.interpolate||A).source,(t.evaluate||A).source].join("|")+"|$","g"),o=0,a="__p+='";s.replace(n,function(t,e,n,r,i){return a+=s.slice(o,i).replace(x,b),o=i+t.length,e?a+="'+\n((__t=("+e+"))==null?'':_.escape(__t))+\n'":n?a+="'+\n((__t=("+n+"))==null?'':__t)+\n'":r&&(a+="';\n"+r+"\n__p+='"),t}),a+="';\n",t.variable||(a="with(obj||{}){\n"+a+"}\n"),a="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+a+"return __p;\n";try{var r=new Function(t.variable||"obj","_",a)}catch(t){throw t.source=a,t}function i(t){return r.call(this,t,p)}var u=t.variable||"obj";return i.source="function("+u+"){\n"+a+"}",i},p.chain=function(t){var e=p(t);return e._chain=!0,e};function R(t){return this._chain?p(t).chain():t}(p.mixin=function(n){p.each(p.functions(n),function(t){var e=p[t]=n[t];p.prototype[t]=function(){var t=[this._wrapped];return a.apply(t,arguments),R.call(this,e.apply(p,t))}})})(p),p.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var n=r[e];p.prototype[e]=function(){var t=this._wrapped;return n.apply(t,arguments),"shift"!==e&&"splice"!==e||0!==t.length||delete t[0],R.call(this,t)}}),p.each(["concat","join","slice"],function(t){var e=r[t];p.prototype[t]=function(){return R.call(this,e.apply(this._wrapped,arguments))}}),p.prototype.value=function(){return this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return p})}.call(void 0);